# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Functions**

* [`libkv::add_libkv`](#libkvadd_libkv): Add libkv 'extension' to the catalog instance, if it is not present
* [`libkv::delete`](#libkvdelete): Deletes a `key` from the configured backend.
* [`libkv::deletetree`](#libkvdeletetree): Deletes a whole folder from the configured backend.
* [`libkv::exists`](#libkvexists): Returns whether the `key` exists in the configured backend.
* [`libkv::get`](#libkvget): Retrieves the value and any metadata stored at `key` from the  configured backend.
* [`libkv::get_backend_config`](#libkvget_backend_config): Create merged backend configuration and then validate it.  The `options` argument is merged with `libkv::options` Hiera and global libkv defa
* [`libkv::list`](#libkvlist): Returns a list of all keys in a folder.
* [`libkv::put`](#libkvput): Sets the data at `key` to the specified `value` in the configured backend. Optionally sets metadata along with the `value`.
* [`libkv::validate_backend_config`](#libkvvalidate_backend_config): Validate backend configuration
* [`libkv::validate_key`](#libkvvalidate_key): Validates key conforms to the libkv key specification  * libkv key specification   * Key must contain only the following characters:     * a-

## Functions

### libkv::add_libkv

Type: Ruby 4.x API

Add libkv 'extension' to the catalog instance, if it is not present

#### `libkv::add_libkv()`

Add libkv 'extension' to the catalog instance, if it is not present

Returns: `Nil`

Raises:
* `LoadError` if libkv adapter software fails to load

### libkv::delete

Type: Ruby 4.x API

Deletes a `key` from the configured backend.

#### `libkv::delete(String[1] $key, Optional[Hash] $options)`

Deletes a `key` from the configured backend.

Returns: `Boolean` `true` when backend operation succeeds; `false` when the
backend operation fails and 'softfail' is `true` in the merged backend
options

Raises:
* `If` the key or merged backend config is invalid
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `key`

Data type: `String[1]`

The key to be removed

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catalog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::deletetree

Type: Ruby 4.x API

Deletes a whole folder from the configured backend.

#### `libkv::deletetree(String[1] $keydir, Optional[Hash] $options)`

Deletes a whole folder from the configured backend.

Returns: `Boolean` `true` when backend operation succeeds; `false` when the
backend operation fails and 'softfail' is `true` in the merged backend
options

Raises:
* `If` the key folder or merged backend config is invalid
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `keydir`

Data type: `String[1]`

The key folder to be removed

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catatlog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::exists

Type: Ruby 4.x API

Returns whether the `key` exists in the configured backend.

#### `libkv::exists(String[1] $key, Optional[Hash] $options)`

Returns whether the `key` exists in the configured backend.

Returns: `Enum[Boolean,Undef]` If the backend operation succeeds, returns
`true` or `false`; if the backend operation fails and 'softfail' is `true`
in the merged backend options, returns nil

Raises:
* `If` the key is invalid, the requested backend does not exist in `libkv::options`, or the plugin for the requested backend is not available.
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `key`

Data type: `String[1]`

The key to be set

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catalog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::get

Type: Ruby 4.x API

Retrieves the value and any metadata stored at `key` from the
 configured backend.

#### `libkv::get(String[1] $key, Optional[Hash] $options)`

Retrieves the value and any metadata stored at `key` from the
 configured backend.

Returns: `Enum[Hash,Undef]` Hash containing the value and any metadata upon
success; Undef when the backend operation fails and 'softfail' is `true`
in the merged backend options

* Hash will have a 'value' key containing the retrieved value
* Hash may have a 'metadata' key containing a Hash with any metadata for
  the key

Raises:
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `key`

Data type: `String[1]`

The key to retrieve

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catalog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::get_backend_config

Type: Ruby 4.x API

Create merged backend configuration and then validate it.

The `options` argument is merged with `libkv::options` Hiera and global libkv
defaults. Validation includes the following checks:

* configuration for the selected backend exists
* the plugin for the selected backend has been loaded
* different configuration for a specific plugin instance does not exist

#### `libkv::get_backend_config(Hash $options, Array $backends, String[1] $resource_info)`

Create merged backend configuration and then validate it.

The `options` argument is merged with `libkv::options` Hiera and global libkv
defaults. Validation includes the following checks:

* configuration for the selected backend exists
* the plugin for the selected backend has been loaded
* different configuration for a specific plugin instance does not exist

Returns: `Hash` ] merged libkv options that will have the backend to use
specified by 'backend'

Raises:
* `if` merged configuration fails validation

##### `options`

Data type: `Hash`

Hash that specifies libkv backend options to be merged with
`libkv::options`.

##### `backends`

Data type: `Array`

List of backends for which plugins have been successfully
loaded.

##### `resource_info`

Data type: `String[1]`

Resource string for the Puppet class or define that has
called the libkv function.

* Examples: 'Class[Mymodule::Myclass]' or 'Mymodule::Mydefine[myinstance]'
* Used to determine the default backend to use, when none is specified
  in the libkv options Hash

### libkv::list

Type: Ruby 4.x API

Returns a list of all keys in a folder.

#### `libkv::list(String[1] $keydir, Optional[Hash] $options)`

Returns a list of all keys in a folder.

Returns: `Enum[Hash,Undef]` Hash containing the key/info pairs upon
success; Undef when the backend operation fails and 'softfail' is `true`
in the merged backend options

* Each key in the Hash is a key found in the folder
* Each value in the Hash is a Hash with a 'value' key and an optional 'metadata'
  key.

Raises:
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `keydir`

Data type: `String[1]`

The key folder to be removed

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catalog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::put

Type: Ruby 4.x API

Sets the data at `key` to the specified `value` in the configured backend.
Optionally sets metadata along with the `value`.

#### `libkv::put(String[1] $key, NotUndef $value, Optional[Hash] $metadata, Optional[Hash] $options)`

Sets the data at `key` to the specified `value` in the configured backend.
Optionally sets metadata along with the `value`.

Returns: `Boolean` `true` when backend operation succeeds; `false` when the
backend operation fails and 'softfail' is `true` in the merged backend
options

Raises:
* `If` the key or merged backend config is invalid
* `If` the libkv adapter cannot be loaded
* `If` the backend operation fails, unless 'softfail' is `true` in the merged backend options.

##### `key`

Data type: `String[1]`

The key to be set

##### `value`

Data type: `NotUndef`

The value of the key

##### `metadata`

Data type: `Optional[Hash]`

Additional information to be persisted

##### `options`

Data type: `Optional[Hash]`

Hash that specifies global libkv options and/or the specific
backend to use (with or without backend-specific configuration).
Will be merged with `libkv::options`.

Supported options keys:

* `backends`: Hash.  Hash of backend configurations

  * Each backend configuration in the merged options Hash must be
    a Hash that has the following keys:

    * `type`:  Backend type.
    * `id`:  Unique name for the instance of the backend. (Same backend
      type can be configured differently).

   * Other keys for configuration specific to the backend may also be
     present.

* `backend`: String.  Name of the backend to use.

  * When present, must match a key in the `backends` option of the
    merged options Hash.
  * When absent and not specified in `libkv::options`, this function
    will look for a 'default.xxx' backend whose name matches the
    `resource` option.  This is typically the catalog resource id of the
    calling Class, specific defined type instance, or defined type.
    If no match is found, it will use the 'default' backend.

* `environment`: String.  Puppet environment to prepend to keys.

  * When set to a non-empty string, it is prepended to the key used in
    the backend operation.
  * Should only be set to an empty string when the key being accessed is
    truly global.
  * Defaults to the Puppet environment for the node.

* `resource`: String.  Name of the Puppet resource initiating this libkv
  operation

  * Required when `backend` is not specified and you want to be able
    to use more than the `default` backend.
  * String should be resource as it would appear in the catalog or
    some application grouping id

    * 'Class[<class>]' for a class, e.g.  'Class[Mymodule::Myclass]'
    * '<Defined type>[<instance>]' for a defined type instance, e.g.,
      'Mymodule::Mydefine[myinstance]'

  * Catalog resource id cannot be reliably determined automatically.
    Appropriate scope is not necessarily available when a libkv function
    is called within any other function.  This is problematic for heavily
    used Puppet built-in functions such as `each`.

### libkv::validate_backend_config

Type: Ruby 4.x API

Validate backend configuration

#### `libkv::validate_backend_config(Hash $options, Array $backends)`

Validate backend configuration

Returns: `Nil`

Raises:
* `if` a backend has not been specified, appropriate configuration for a specified backend cannot be found, or different backend configurations are provided for the same ['type', 'id'] pair.

##### `options`

Data type: `Hash`

Hash that specifies libkv backend options

##### `backends`

Data type: `Array`

List of backends for which plugins have been successfully
loaded.

### libkv::validate_key

Type: Ruby 4.x API

Validates key conforms to the libkv key specification

* libkv key specification
  * Key must contain only the following characters:
    * a-z
    * A-Z
    * 0-9
    * The following special characters: `._:-/`
  * Key may not contain '/./' or '/../' sequences.
* Terminates catalog compilation if validation fails.

#### Examples

##### Passing

```puppet
libkv::validate_key('looks/like/a/file/path')
libkv::validate_key('looks/like/a/directory/path/')
libkv::validate_key('simp-simp_snmpd:password.auth')
```

##### Failing

```puppet
libkv::validate_key('${special}/chars/not/allowed!'}
libkv::validate_key('looks/like/an/./unexpanded/linux/path')
libkv::validate_key('looks/like/another/../unexpanded/linux/path')
```

#### `libkv::validate_key(String[1] $key)`

Validates key conforms to the libkv key specification

* libkv key specification
  * Key must contain only the following characters:
    * a-z
    * A-Z
    * 0-9
    * The following special characters: `._:-/`
  * Key may not contain '/./' or '/../' sequences.
* Terminates catalog compilation if validation fails.

Returns: `Nil`

Raises:
* `if` validation fails

##### Examples

###### Passing

```puppet
libkv::validate_key('looks/like/a/file/path')
libkv::validate_key('looks/like/a/directory/path/')
libkv::validate_key('simp-simp_snmpd:password.auth')
```

###### Failing

```puppet
libkv::validate_key('${special}/chars/not/allowed!'}
libkv::validate_key('looks/like/an/./unexpanded/linux/path')
libkv::validate_key('looks/like/another/../unexpanded/linux/path')
```

##### `key`

Data type: `String[1]`

libkv key

